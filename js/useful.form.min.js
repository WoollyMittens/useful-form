/*
	Source:
	van Creij, Maurice (2012). "useful.form.js: Commonly reused functionality for forms in HTML5.", version 20120606, http://www.woollymittens.nl/.

	License:
	This work is licensed under a Creative Commons Attribution 3.0 Unported License.

	Prerequisites:
	<script src="./js/useful.js"></script>
*/(function(e){"use strict";var t={};t={setup:function(n,r){var i,s,o;r.parent=n;t.events.formSubmit(r.parent,r);o=e.css.select(r.input,r.parent);for(i=0,s=o.length;i<s;i+=1)t.events.elementChange(o[i],r)},events:{formSubmit:function(e,n){e.onsubmit=function(){return t.check(n.parent,n)}},elementChange:function(n,r){e.events.add(n,"change",function(){t.check(r.parent,r)})}},find:function(e){var t=e;while(t.nodeName!=="FORM"&&t.nodeName!=="BODY")t=t.parentNode;if(t.nodeName==="BODY"){t=e;while(t.getAttribute("id")===null&&t.nodeName!=="BODY")t=t.parentNode}return t},check:function(n,r){var i=!0,s=n.getElementsByTagName("*"),o="";for(var u=0;u<s.length;u+=1)if(s[u].nodeName.indexOf("#")<0&&s[u].getAttribute("required")!==null&&s[u].getAttribute("required")!=="false"){var a=t.validate(s[u],r);o+=a?"":'<span class="notification">'+s[u].title+" is a required field.</span>";i=i&&a}if(r.failure!==null){var f=e.css.select(r.output)[0];if(!i){f.className=f.className.match(/hide/)?f.className.replace("hide","show"):f.className+" show";f.innerHTML=r.failure.replace("{0}",o)}else{f.className=f.className.match(/show/)?f.className.replace("show","hide"):f.className+" hide";f.innerHTML=""}}return i},validate:function(e){var t=!0,n=e.getAttribute("required");if(e.offsetWidth!==0&&n!==null&&n!=="false"){var r=e.getAttribute("pattern");if(r!==null)t=e.value.match(new RegExp(r))!==null;else switch(e.type){case"checkbox":t=e.checked;break;case"radio":t=!1;var i=document.getElementsByName(e.name);for(var s=0,o=i.length;s<o;s+=1)t=i[s].checked||t;break;default:t=e.value!==""&&e.value!==e.getAttribute("placeholder")}t?e.parentNode.className=e.parentNode.className.replace(" error","").replace("error",""):e.parentNode.className+=e.parentNode.className.indexOf("error")<0?" error":""}return t},update:function(t,n,r){var i=i.find(t),s=e.storage.settings(t.name);clearTimeout(s.timeout);s.timeout=setTimeout(function(){i.submit(i,r)},500);e.events.cancel(n)},submit:function(t,n,r){var i=i.find(t),s=i.check(i,r);if(r.ajax){var o=e.storage.settings(t.name);if(s){clearTimeout(o.timeout);o.timeout=setTimeout(function(){i.send(i,r)},500)}e.events.cancel(n)}else s||e.events.cancel(n)},send:function(t,n){var r=t.values(t,n),i=t.method;n.url!==null&&(r=n.url+(n.url.indexOf("?")<0?"?":"&")+r.split("?")[1]);n.method!==null&&(i=n.method);e.request.send({url:i==="post"?r.split("?")[0]:r,post:i==="post"?r.split("?")[1]:null,onProgress:function(){t.className=t.className.split(" update_")[0]+" form_busy"},onFailure:function(e){return e},onSuccess:function(n){e.updates.rewrite(n.responseText);t.className=t.className.split(" update_")[0]}})},values:function(e,t){var n=t!==null&&t.url!==null?t.url:e.getAttribute("action");n.indexOf("?")<0&&(n+="?foo=bar");var r=e.getElementsByTagName("*");for(var i=0,s=r.length;i<s;i+=1)if(r[i].nodeName==="INPUT"||r[i].nodeName==="SELECT"||r[i].nodeName==="TEXTAREA")switch(r[i].type){case"radio":r[i].checked&&(n+="&"+r[i].name+"="+r[i].value);break;case"checkbox":r[i].checked&&(n+="&"+r[i].name+"="+r[i].value);break;case"button":break;case"submit":break;case"reset":break;default:n+="&"+r[i].name+"="+r[i].value}return n}};e.form={};e.form.setup=t.setup;var n={};n={init:function(e,t){if(!t.support){var r=e.getAttribute("placeholder");r&&n.create(e,t)}else e.value===e.getAttribute("placeholder")&&(e.value="")},create:function(e,t){var r=document.createElement("span");r.className="placeholder";r.innerHTML=e.getAttribute("placeholder");r.style.position="absolute";r.style.color=t.color;r.style.visibility="hidden";r.style.left=t.offsetX+"px";r.style.top=t.offsetY+"px";r.style.zIndex=10;e.parentNode.insertBefore(r,e);n.show(e,r,t);setInterval(function(){n.show(e,r,t)},1e3)},show:function(e,t){e.value===""?t.style.visibility="visible":t.style.visibility="hidden"},hide:function(e,t){t.style.visibility="hidden"},focus:function(e,t,r){n.hide(e,t,r);setTimeout(function(){e.focus()},100)}};e.placeholder={};e.placeholder.init=n.init;var r={};r={init:function(e){var t,n,i;t=document.createElement("div");t.className="file button";e.parentNode.insertBefore(t,e);n=e.parentNode.removeChild(e);t.appendChild(n);i=document.createElement("div");i.className="file-readout";t.appendChild(i);e.onchange=function(){r.update(e,i)};r.update(e,i)},update:function(e,t){t.innerHTML=e.value}};e.file={};e.file.init=r.init;var i={};i={init:function(e,t){t.parent=e;if(!t.support){i.setup(t);i.update(t)}},setup:function(e){e.width=e.width||e.parent.offsetWidth;e.height=e.height||e.parent.offsetHeight;e.container=document.createElement("span");e.container.className="color";e.parent.parentNode.insertBefore(e.container,e.parent);e.container.appendChild(e.parent.parentNode.removeChild(e.parent));e.button=document.createElement("span");e.button.className="color_button color_passive";e.container.appendChild(e.button);i.events.pick(e.button,e);i.events.reset(document.body,e);i.events.change(e.parent,e)},update:function(e){e.button.innerHTML=e.color;e.button.title=e.color;e.button.style.backgroundColor=e.color;e.parent.value=e.color;i.popup.update(e)},events:{change:function(t,n){e.events.add(t,"change",function(){var e;e=parseInt(t.value.replace("#",""),16);if(!isNaN(e)&&t.value.match(/#/)&&(t.value.length===4||t.value.length===7)){n.color=t.value;i.update(n)}})},pick:function(e,t){e.onclick=function(){i.popup.setup(t);return!1}},reset:function(t,n){e.events.add(t,"click",function(){i.popup.remove(n);return!1})}},popup:{setup:function(t){var n,r,s,o,u;t.popup&&t.popup.parentNode.removeChild(t.popup);t.hover=!1;t.popup=document.createElement("div");t.popup.className="color_popup color_hidden";t.colourInput=document.createElement("fieldset");r={red:"Red: ",green:"Green: ",blue:"Blue: "};for(n in r)if(r.hasOwnProperty(n)){s=n+"Label";o=n+"Input";u=n+"Slider";t[s]=document.createElement("label");t[s].innerHTML=r[n];t[o]=document.createElement("input");t[o].setAttribute("type","number");t[o].setAttribute("name",o);t[o].setAttribute("min","0");t[o].setAttribute("max","255");t[o].setAttribute("step","1");t[o].setAttribute("value","127");t[u]=document.createElement("input");t[u].setAttribute("type","range");t[u].setAttribute("class","range");t[u].setAttribute("name",u);t[u].setAttribute("min","0");t[u].setAttribute("max","255");t[u].setAttribute("step","1");t[u].setAttribute("value","127");t[s].appendChild(t[o]);t.colourInput.appendChild(t[s]);t.colourInput.appendChild(t[u])}t.popup.appendChild(t.colourInput);document.body.appendChild(t.popup);t.position=e.positions.object(t.button);t.limits=e.positions.window();t.position.x-=t.position.x+t.popup.offsetWidth>t.limits.x?t.popup.offsetWidth:0;t.position.y-=t.position.y+t.popup.offsetHeight>t.limits.y?t.popup.offsetHeight:0;t.popup.style.left=t.position.x+t.button.offsetWidth+"px";t.popup.style.top=t.position.y+t.button.offsetHeight+"px";i.popup.update(t);i.popup.reveal(t);i.popup.events.popUpOver(t.popup,t);i.popup.events.popUpOut(t.popup,t);for(n in r)if(r.hasOwnProperty(n)){o=n+"Input";u=n+"Slider";i.popup.events.inputChange(t[o],n,t);i.popup.events.sliderChange(t[u],n,t);e.range.init(t[u],{title:"{value} ({min}-{max})",support:navigator.userAgent.match(/webkit|opera|msie 10/gi)})}},update:function(e){var t,n,r;if(e.popup)if(e.color.length===7){t=parseInt(e.color.substr(1,2),16);e.redInput.value=t;e.redSlider.value=t;n=parseInt(e.color.substr(3,2),16);e.greenInput.value=n;e.greenSlider.value=n;r=parseInt(e.color.substr(5,2),16);e.blueInput.value=r;e.blueSlider.value=r}else if(e.color.length===4){t=e.color.substr(1,1);t=parseInt(t+t,16);e.redInput.value=t;e.redSlider.value=t;n=e.color.substr(2,1);n=parseInt(n+n,16);e.greenInput.value=n;e.greenSlider.value=n;r=e.color.substr(3,1);r=parseInt(r+r,16);e.blueInput.value=r;e.blueSlider.value=r}},convert:function(e){var t,n,r;t=parseInt(e.redInput.value,10).toString(16);t=t.length===1?"0"+t:t;n=parseInt(e.greenInput.value,10).toString(16);n=n.length===1?"0"+n:n;r=parseInt(e.blueInput.value,10).toString(16);r=r.length===1?"0"+r:r;e.color="#"+t+n+r},reveal:function(e){setTimeout(function(){e.popup.className=e.popup.className.replace("color_hidden","color_visible")},100)},remove:function(e){e.popup&&!e.hover&&(e.popup.className=e.popup.className.replace("color_visible","color_hidden"))},events:{inputChange:function(e,t,n){e.onchange=function(){var r,s,o;o=parseInt(e.value,10);r=parseFloat(e.getAttribute("min"));s=parseFloat(e.getAttribute("max"));isNaN(o)&&(o=0);o<r&&(o=r);o>s&&(o=s);n[t+"Input"].value=o;n[t+"Slider"].value=o;i.popup.convert(n);i.update(n)}},sliderChange:function(e,t,n){e.onchange=function(){n[t+"Input"].value=parseInt(e.value,10);i.popup.convert(n);i.update(n)}},popUpOver:function(e,t){e.onmouseover=function(){t.hover=!0}},popUpOut:function(e,t){e.onmouseout=function(){t.hover=!1}}}}};e.color={};e.color.init=i.init;var s={};s={init:function(e,t){t.parent=e;if(!t.support){s.setup(t);s.update(t)}},setup:function(e){e.width=e.width||e.parent.offsetWidth;e.height=e.height||e.parent.offsetHeight;e.container=document.createElement("span");e.container.className="date";e.parent.parentNode.insertBefore(e.container,e.parent);e.container.appendChild(e.parent.parentNode.removeChild(e.parent));e.button=document.createElement("span");e.button.innerHTML="<span>"+(new Date).getDate()+"</span>";e.button.className="date_button date_passive";e.container.appendChild(e.button);s.events.reverse(e.parent,e);s.events.pick(e.button,e);s.events.reset(document.body,e)},update:function(e){e.date?e.parent.value=e.format.replace("d",e.date.getDate()).replace("m",e.date.getMonth()+1).replace("M",e.months[e.date.getMonth()]).replace("y",e.date.getFullYear()):e.date=new Date},events:{pick:function(e,t){e.onclick=function(){s.popup.setup(t);return!1}},reset:function(t,n){e.events.add(t,"click",function(){s.popup.remove(n);return!1})},reverse:function(t,n){e.events.add(t,"keyup",function(){var e,r,i;e=t.value;switch(n.format){case"d/m/y":r=e.split("/");i=e.length>1?new Date(r[2],r[1]-1,r[0]):new Date(e);break;default:i=new Date(e)}isNaN(i)||(n.date=i)})}},popup:{setup:function(t){t.popup&&t.popup.parentNode.removeChild(t.popup);t.hover=!1;t.popup=document.createElement("div");t.popup.className="date_popup date_hidden";t.title=document.createElement("strong");t.title.innerHTML="{title}";t.popup.appendChild(t.title);t.selectors=document.createElement("div");t.selectors.className="date_selectors";t.popup.appendChild(t.selectors);s.popup.addMonthSelector(t);s.popup.addYearSelector(t);t.previousMonth=document.createElement("button");t.previousMonth.className="button date_previous_month";t.previousMonth.innerHTML="&lt;";t.popup.appendChild(t.previousMonth);s.popup.events.previousMonth(t.previousMonth,t);t.nextMonth=document.createElement("button");t.nextMonth.className="button date_next_month";t.nextMonth.innerHTML="&gt;";t.popup.appendChild(t.nextMonth);s.popup.events.nextMonth(t.nextMonth,t);t.previousYear=document.createElement("button");t.previousYear.innerHTML="&lt;&lt;";t.previousYear.className="button date_previous_year";t.popup.appendChild(t.previousYear);s.popup.events.previousYear(t.previousYear,t);t.nextYear=document.createElement("button");t.nextYear.innerHTML="&gt;&gt;";t.nextYear.className="button date_next_year";t.popup.appendChild(t.nextYear);s.popup.events.nextYear(t.nextYear,t);t.today=document.createElement("button");t.today.innerHTML="Today";t.today.className="button date_today";t.popup.appendChild(t.today);s.popup.events.today(t.today,t);t.clear=document.createElement("button");t.clear.innerHTML="Clear";t.clear.className="button date_clear";t.popup.appendChild(t.clear);s.popup.events.clear(t.clear,t);s.popup.calendar.setup(t);document.body.appendChild(t.popup);t.position=e.positions.object(t.button);t.limits=e.positions.window();t.position.x-=t.position.x+t.popup.offsetWidth>t.limits.x?t.popup.offsetWidth:0;t.position.y-=t.position.y+t.popup.offsetHeight>t.limits.y?t.popup.offsetHeight:0;t.popup.style.left=t.position.x+"px";t.popup.style.top=t.position.y+"px";s.popup.update(t);s.popup.reveal(t);s.popup.events.over(t.popup,t);s.popup.events.out(t.popup,t)},addMonthSelector:function(e){var t,n,r;e.monthPicker=document.createElement("select");e.monthPicker.setAttribute("name","pickmonth");for(t=0,n=e.months.length;t<n;t+=1){r=document.createElement("option");r.innerHTML=e.months[t];r.value=t;e.monthPicker.appendChild(r)}s.popup.events.selectMonth(e.monthPicker,e);e.selectors.appendChild(e.monthPicker)},addYearSelector:function(e){var t,n,r;e.yearPicker=document.createElement("select");e.yearPicker.setAttribute("name","pickyear");n=e.years[0];r=(new Date).getFullYear();while(n!==e.years[1]){t=document.createElement("option");t.innerHTML=r+n;t.value=r+n;e.yearPicker.appendChild(t);n+=e.years[0]>e.years[1]?-1:1}s.popup.events.selectYear(e.yearPicker,e);e.selectors.appendChild(e.yearPicker)},update:function(e){var t,n,r,i,o;r=e.reference.getMonth();i=e.reference.getFullYear();e.title.innerHTML=e.months[r]+" "+i;o=e.yearPicker.getElementsByTagName("option");for(t=0,n=o.length;t<n;t+=1)o[t].selected=parseInt(o[t].value,10)===i;o=e.monthPicker.getElementsByTagName("option");for(t=0,n=o.length;t<n;t+=1)o[t].selected=parseInt(o[t].value,10)===r;s.popup.calendar.update(e)},doNotClose:function(e){e.hover=!0;setTimeout(function(){e.hover=!1},100)},reveal:function(e){setTimeout(function(){e.popup.className=e.popup.className.replace("date_hidden","date_visible")},100)},remove:function(e){e.popup&&!e.hover&&(e.popup.className=e.popup.className.replace("date_visible","date_hidden"))},events:{clear:function(e,t){e.onclick=function(){t.date=null;t.parent.value="";t.hover=!1;s.popup.remove(t);s.update(t);return!1}},today:function(e,t){e.onclick=function(){t.date=new Date;s.update(t);t.hover=!1;s.popup.remove(t);return!1}},nextMonth:function(e,t){e.onclick=function(){t.reference=new Date(t.reference.getFullYear(),t.reference.getMonth()+1,t.reference.getDate());s.popup.update(t);return!1}},previousMonth:function(e,t){e.onclick=function(){t.reference=new Date(t.reference.getFullYear(),t.reference.getMonth()-1,t.reference.getDate());s.popup.update(t);return!1}},selectMonth:function(e,t){e.onchange=function(){s.popup.doNotClose(t);t.reference=new Date(t.reference.getFullYear(),parseInt(e.value,10),t.reference.getDate());s.popup.update(t)}},nextYear:function(e,t){e.onclick=function(){t.reference=new Date(t.reference.getFullYear()+1,t.reference.getMonth(),t.reference.getDate());s.popup.update(t);return!1}},previousYear:function(e,t){e.onclick=function(){t.reference=new Date(t.reference.getFullYear()-1,t.reference.getMonth(),t.reference.getDate());s.popup.update(t);return!1}},selectYear:function(e,t){e.onchange=function(){s.popup.doNotClose(t);t.reference=new Date(parseInt(e.value,10),t.reference.getMonth(),t.reference.getDate());s.popup.update(t)}},over:function(e,t){e.onmouseover=function(){t.hover=!0}},out:function(e,t){e.onmouseout=function(){t.hover=!1}}},calendar:{setup:function(e){e.reference=new Date(e.date.getFullYear(),e.date.getMonth(),1);e.minimum=new Date(e.parent.getAttribute("min"));isNaN(e.minimum)&&(e.minimum=new Date(0));e.maximum=new Date(e.parent.getAttribute("max"));if(isNaN(e.maximum)||e.maximum.getTime()===0)e.maximum=new Date(2200,1,1);e.calendar=document.createElement("div");e.calendar.className="date_calendar";e.popup.appendChild(e.calendar)},update:function(e){var t,n,r,i,o,u,a,f,l,c,h,p,d;o=new Date(e.reference.getFullYear(),e.reference.getMonth(),1);a=document.createElement("table");f=document.createElement("thead");c=document.createElement("tr");for(t=0,n=7;t<n;t+=1){h=document.createElement("th");h.innerHTML=e.days[t];t===0?h.className="date_first":t===6&&(h.className="date_last");c.appendChild(h)}f.appendChild(c);a.appendChild(f);l=document.createElement("tbody");u=1;r=7-o.getDay()+1;r>6&&(r=0);i=o.getMonth();while(i===o.getMonth()&&u<32){c=document.createElement("tr");for(t=0,n=7;t<n;t+=1){h=document.createElement("td");if(u-r===o.getDate()){if(o.getTime()>e.minimum.getTime()&&o.getTime()<e.maximum.getTime()){p=document.createElement("a");p.innerHTML=o.getDate();p.href="#"+o.getDate()+"-"+(o.getMonth()+1)+"-"+o.getFullYear();h.appendChild(p);s.popup.calendar.events.dateClick(p,new Date(o.getFullYear(),o.getMonth(),o.getDate()),e)}else{d=document.createElement("span");d.innerHTML=o.getDate();h.appendChild(d)}o=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1)}else h.innerHTML="";t===0?h.className="date_first":t===6&&(h.className="date_last");o.getFullYear()===e.date.getFullYear()&&o.getMonth()===e.date.getMonth()&&o.getDate()===e.date.getDate()+1&&(h.className+=" date_current");c.appendChild(h);u+=1}l.appendChild(c)}a.appendChild(l);e.calendar.innerHTML="";e.calendar.appendChild(a)},events:{dateClick:function(e,t,n){e.onclick=function(){n.date=t;s.update(n);n.hover=!1;s.popup.remove(n);return!1}}}}}};e.date={};e.date.init=s.init;var o={};o={init:function(e,t){if(!t.support&&!e.parentNode.className.match(/range/)){t.parent=e;o.setup(t);o.update(t)}},setup:function(e){e.parent.value=e.parent.value||0;e.width=e.width||e.parent.offsetWidth;e.height=e.height||e.parent.offsetHeight;e.container=document.createElement("span");e.container.className="range";e.parent.parentNode.insertBefore(e.container,e.parent);e.container.appendChild(e.parent.parentNode.removeChild(e.parent));e.rails=document.createElement("span");e.rails.className="range_rails";e.container.appendChild(e.rails);e.button=document.createElement("span");e.button.className="range_button range_passive";e.container.appendChild(e.button);o.events.mouse(e.container,e);clearInterval(e.interval);e.interval=setInterval(function(){o.update(e)},500)},update:function(t){var n,r,i,s,o;n=parseFloat(t.parent.getAttribute("min"))||0;r=parseFloat(t.parent.getAttribute("max"))||1;s=parseFloat(t.parent.getAttribute("steps"))||0;o=r-n;t.offset=e.positions.object(t.container);i=t.x===null?parseFloat(t.parent.value):(t.x-t.offset.x)/t.container.offsetWidth*o+n;if(s){var u;u=i%s;i=u>s/2?i+(s-u):i-u}i<n&&(i=n);i>r&&(i=r);t.button.style.left=Math.round((i-n)/o*100)+"%";t.title&&t.container.setAttribute("title",t.title.replace("{value}",Math.round(i)).replace("{min}",n).replace("{max}",r));t.parent.value=i;t.x!==null&&e.events.trigger(t.parent,"change")},events:{mouse:function(t,n){n.x=null;n.reset=null;t.onmouseout=function(){clearTimeout(n.reset);n.reset=setTimeout(function(){n.x=null;n.motion=!1;n.button.className=n.button.className.replace("_active","_passive")},100)};t.onmouseover=function(){clearTimeout(n.reset)};t.onmousedown=function(t){t=t||window.event;n.x=t.pageX||t.x+n.offset.x;n.button.className=n.button.className.replace("_passive","_active");o.update(n);e.events.cancel(t)};t.onmousemove=function(t){t=t||window.event;if(n.x!==null){n.x=t.pageX||t.x+n.offset.x;o.update(n)}e.events.cancel(t)};t.onmouseup=function(t){t=t||window.event;n.x=null;n.button.className=n.button.className.replace("_active","_passive");e.events.cancel(t)}}}};e.range={};e.range.init=o.init;e.events=e.events||{};e.events.add=function(e,t,n){t=navigator.userAgent.match(/Firefox/i)&&t.match(/mousewheel/i)?"DOMMouseScroll":t;"addEventListener"in e?e.addEventListener(t,n,!1):"attachEvent"in e?e.attachEvent("on"+t,function(e){n(e)}):e["on"+t]=n};e.events.trigger=function(t,n){typeof events!="undefined"&&(n=e.events.name(n));if("fireEvent"in t)t.fireEvent("on"+n);else if("dispatchEvent"in t){var r=document.createEvent("HTMLEvents");r.initEvent(n,!1,!0);t.dispatchEvent(r)}else t["on"+n]()};e.events.cancel=function(e){e&&(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)};e.models=e.models||{};e.models.clone=function(e){var t,n;if(typeof Object.create!="undefined")t=Object.create(e);else{n=function(){};n.prototype=e;t=new n}return t};e.css=e.css||{};e.css.select=function(t,n){var r,i,s;n=n||document;t=typeof t=="string"?{rule:t,parent:n}:t;t.parent=t.parent||document;t.data=t.data||{};s=typeof document.querySelectorAll!="undefined"?t.parent.querySelectorAll(t.rule):typeof jQuery!="undefined"?jQuery(t.parent).find(t.rule).get():[];if(typeof t.handler=="undefined")return s;for(r=0,i=s.length;r<i;r+=1)t.handler(s[r],e.models.clone(t.data))};e.positions=e.positions||{};e.positions.window=function(){var e={x:0,y:0};e.x=window.innerWidth||document.body.offsetWidth;e.y=window.innerHeight||document.body.offsetHeight;return e};e.positions.object=function(e){var t={x:0,y:0};if(e.offsetParent)while(e.offsetParent){t.x+=e.offsetLeft;t.y+=e.offsetTop;e=e.offsetParent}return t}})(window.useful=window.useful||{});